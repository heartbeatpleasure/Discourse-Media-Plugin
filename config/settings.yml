plugins:
  media_gallery_enabled:
    default: true
    client: true

  # Viewing rules (members-only). Leave empty to allow all logged-in users.
  media_gallery_viewer_groups:
    default: ""
    type: list
    client: false

  # Upload rules
  media_gallery_allowed_uploader_groups:
    default: "trust_level_0"
    type: list
    client: false

  # Optional URL to an "Upload Terms" topic/page. Shown next to the required authorization checkbox.
  media_gallery_upload_terms_url:
    default: ""
    type: string
    client: true

  # Optional extra size limit (MB) on top of Discourse's max_attachment_size_kb. 0 = disabled.
  media_gallery_max_upload_size_mb:
    default: 0
    client: false

  # Per-type size limits for registering media into the gallery (MB).
  # IMPORTANT: uploads.json is still governed by Discourse core limits + nginx upload_size.
  # These limits are enforced when calling POST /media (registration), not at the raw upload step.
  media_gallery_max_video_size_mb:
    default: 200
    client: false

  media_gallery_max_audio_size_mb:
    default: 50
    client: false

  media_gallery_max_image_size_mb:
    default: 20
    client: false

  media_gallery_max_tags_per_item:
    default: 10
    client: false

  media_gallery_allowed_tags:
    default: ""
    type: list
    client: true


  # Allowed extensions (no dots). These are additional restrictions on top of Discourse core upload rules.
  media_gallery_allowed_image_extensions:
    default: "jpg|jpeg|png|webp"
    type: list
    client: true

  media_gallery_allowed_video_extensions:
    default: "mp4|webm|mkv"
    type: list
    client: true

  media_gallery_allowed_audio_extensions:
    default: "mp3|m4a|ogg|wav"
    type: list
    client: true
  # Transcoding / policy
  media_gallery_video_max_duration_seconds:
    default: 600
    client: false

  media_gallery_audio_max_duration_seconds:
    default: 900
    client: false

  media_gallery_video_target_bitrate_kbps:
    default: 5000
    client: false

  media_gallery_video_max_fps:
    default: 30
    client: false

  media_gallery_audio_bitrate_kbps:
    default: 128
    client: false

  media_gallery_delete_original_on_success:
    default: true
    client: false

  # Images: standardize output to JPG (requested). Turn off to match the original spec.
  media_gallery_transcode_images_to_jpg:
    default: true
    client: false

  # Visible watermarks (burned into video encodes).
  media_gallery_watermark_enabled:
    default: false
    client: false

  # If false, the watermark toggle is hidden and watermark is always applied on video uploads.
  media_gallery_watermark_user_can_toggle:
    default: true
    client: false

  # If true, users can choose a watermark option from the list below.
  media_gallery_watermark_user_can_choose_preset:
    default: true
    client: false

  # Watermark options (tags-like list). Example entries:
  #  - heartbeatpleasure.com
  #  - @{{username}}
  #  - heartbeatpleasure.com â€¢ @{{username}}
  # Default is the FIRST entry in this list.
  media_gallery_watermark_choices:
    default: ""
    type: list
    client: false

  # Global watermark position (applies to all options).
  media_gallery_watermark_position:
    default: "bottom_right"
    type: enum
    choices:
      - bottom_right
      - bottom_left
      - top_right
      - top_left
      - top_center
      - bottom_center
      - center
    client: false

  # Global watermark opacity (percentage). 100 = solid, 0 = invisible.
  media_gallery_watermark_opacity_percent:
    default: 35
    type: integer
    min: 1
    max: 100
    client: false

  # Global watermark size (% of the long side). Will be clamped so it always fits.
  # (Using the long side keeps the watermark visually consistent between landscape and portrait.)
  media_gallery_watermark_size_percent:
    default: 4.5
    type: float
    min: 0.5
    max: 30
    client: false

  # Global margin (px).
  media_gallery_watermark_margin_px:
    default: 24
    type: integer
    min: 0
    max: 200
    client: false

  # Default watermark text when watermark is enabled and no preset is selected (or available).
  media_gallery_watermark_default_text:
    default: "heartbeatpleasure.com"
    client: false


  # Storage hardening (Option A): store processed media + thumbs outside /uploads.
  # When enabled, the plugin streams files from /shared via tokenized URLs only.
  media_gallery_private_storage_enabled:
    default: true
    client: false

  # Base folder inside the container for private (processed) media. Must be writable by the discourse user.
  media_gallery_private_root_path:
    default: "/shared/media_gallery/private"
    client: false

  # Optional export location for originals (so a NAS can rsync-pull them). Originals are never served publicly.
  media_gallery_original_export_root_path:
    default: "/shared/media_gallery/original_export"
    client: false

  # Retention window for originals in HOURS. 0 = delete immediately after successful processing.
  media_gallery_original_retention_hours:
    default: 4
    client: false

  # Tokenized streaming
  media_gallery_stream_token_ttl_minutes:
    default: 15
    client: false

  # HLS (milestone 1)
  media_gallery_hls_enabled:
    default: false
    client: false

  # Segment duration in seconds. Shorter = faster stop after revoke, more requests.
  media_gallery_hls_segment_duration_seconds:
    default: 6
    type: integer
    min: 2
    max: 10
    client: false

  # Offload HLS segments via Nginx (X-Accel-Redirect). Playlists are still generated by Rails.
  media_gallery_hls_x_accel_enabled:
    default: false
    client: false

  # Internal Nginx location that maps to media_gallery_private_root_path.
  media_gallery_hls_x_accel_internal_location:
    default: "/internal/media-hls/"
    client: false

  # Playback hardening (best-effort)
  # Early revocation lets the client invalidate a token when the overlay is closed.
  media_gallery_revoke_enabled:
    default: true
    client: false

  # Heartbeat enables lightweight concurrent session limiting (useful now and for future HLS).
  media_gallery_heartbeat_enabled:
    default: true
    client: false

  media_gallery_heartbeat_interval_seconds:
    default: 15
    type: integer
    min: 5
    max: 120
    client: false

  # Session TTL should be larger than interval (interval + 10 minimum is enforced server-side).
  media_gallery_heartbeat_ttl_seconds:
    default: 40
    type: integer
    min: 10
    max: 600
    client: false

  # Limits (0 = disabled)
  media_gallery_max_concurrent_sessions_per_user:
    default: 2
    type: integer
    min: 0
    max: 20
    client: false

  media_gallery_max_concurrent_sessions_per_ip:
    default: 4
    type: integer
    min: 0
    max: 50
    client: false

  media_gallery_max_active_tokens_per_user:
    default: 10
    type: integer
    min: 0
    max: 200
    client: false

  media_gallery_max_active_tokens_per_ip:
    default: 50
    type: integer
    min: 0
    max: 500
    client: false

  # Optional: limit how many play tokens a single IP can request per minute.
  # This helps reduce automated scraping attempts without breaking video playback
  # (streaming uses multiple Range requests, so we do NOT rate limit /media/stream).
  # 0 = disabled.
  media_gallery_play_tokens_per_ip_per_minute:
    default: 0
    type: integer
    min: 0
    max: 10000
    client: false

  # Thumbnail caching (stable URL). Used for Cache-Control: private, max-age=...
  # 0 disables browser caching (forces revalidation)
  media_gallery_thumbnail_cache_max_age_seconds:
    default: 86400
    type: integer
    min: 0
    max: 31536000
    client: false

  media_gallery_bind_stream_to_user:
    default: true
    client: false

  media_gallery_bind_stream_to_ip:
    default: false
    client: false

  # Tooling
  media_gallery_ffmpeg_path:
    default: "ffmpeg"
    client: false

  media_gallery_ffprobe_path:
    default: "ffprobe"
    client: false
